<ng-container *ngIf="showSidenav || showSkilledWorkerSidenav">
  <mat-sidenav-container class="sidenav-container" [class.topnav-mode]="isTopnavMode">
    <!-- Desktop Sidenav for Default Users -->
    <mat-sidenav
      *ngIf="showSidenav && !showSkilledWorkerSidenav && !isTopnavMode"
      #sidenav
      [mode]="isMobileView ? 'over' : 'side'"
      [(opened)]="isSidenavOpen"
      class="sidenav custom-sidenav desktop-sidenav"
      [class.mobile-hidden]="isMobileView"
      [class.condensed]="isSidenavCondensed"
    >
      <div class="sidenav-content">
        <div class="sidenav-top">
      <div class="logo-container">
        <img src="assets/system-logo-copy.png" alt="Logo" class="sidenav-logo">
      </div>
          <div class="menu-title" [class.condensed-title]="isSidenavCondensed">MENU</div>
          
          <!-- Top Divider Line -->
          <div class="nav-divider"></div>
          
      <mat-nav-list>
        <a mat-list-item routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" [attr.data-tooltip]="isSidenavCondensed ? 'Home' : null">
          <div class="item-content">
            <mat-icon>home</mat-icon>
                <span class="nav-label" [class.hidden]="isSidenavCondensed">Home</span>
          </div>
        </a>
        <a mat-list-item routerLink="/favorites" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" [attr.data-tooltip]="isSidenavCondensed ? 'Favorites' : null">
          <div class="item-content">
            <mat-icon>favorite</mat-icon>
                <span class="nav-label" [class.hidden]="isSidenavCondensed">Favorites</span>
          </div>
        </a>
        <a mat-list-item routerLink="/transaction" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" [attr.data-tooltip]="isSidenavCondensed ? 'Transactions' : null">
          <div class="item-content">
            <mat-icon>currency_exchange</mat-icon>
                <span class="nav-label" [class.hidden]="isSidenavCondensed">Transactions</span>
          </div>
        </a>
        <a mat-list-item routerLink="/user-messages" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" [attr.data-tooltip]="isSidenavCondensed ? 'Messages' : null">
          <div class="item-content">
            <mat-icon>chat</mat-icon>
                <span class="nav-label" [class.hidden]="isSidenavCondensed">Messages</span>
          </div>
        </a>
        <a mat-list-item routerLink="/user-profile" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" [attr.data-tooltip]="isSidenavCondensed ? 'My Profile' : null">
          <div class="item-content">
            <mat-icon>person</mat-icon>
                <span class="nav-label" [class.hidden]="isSidenavCondensed">My Profile</span>
          </div>
        </a>
        <a mat-list-item routerLink="/about_us" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" [attr.data-tooltip]="isSidenavCondensed ? 'About Us' : null">
          <div class="item-content">
            <mat-icon>info</mat-icon>
                <span class="nav-label" [class.hidden]="isSidenavCondensed">About Us</span>
          </div>
        </a>
          </mat-nav-list>
          
          <!-- Bottom Divider Line -->
          <div class="nav-divider"></div>
        </div>
        <div class="sidenav-bottom">
          <a mat-list-item (click)="logout()" class="logout-button" [attr.data-tooltip]="isSidenavCondensed ? 'Logout' : null">
          <div class="item-content">
            <mat-icon>exit_to_app</mat-icon>
              <span class="nav-label" [class.hidden]="isSidenavCondensed">Logout</span>
          </div>
        </a>
        </div>
      </div>
    </mat-sidenav>

    <!-- Desktop Sidenav for Skilled Workers -->
    <mat-sidenav
      *ngIf="showSkilledWorkerSidenav && !showSidenav && !isTopnavMode"
      #sidenav
      [mode]="isMobileView ? 'over' : 'side'"
      [(opened)]="isSidenavOpen"
      class="sidenav desktop-sidenav"
      [class.mobile-hidden]="isMobileView"
      [class.condensed]="isSidenavCondensed"
    >
      <div class="sidenav-content">
        <div class="sidenav-top">
      <div class="logo-container">
        <img src="assets/system-logo-copy.png" alt="Logo" class="sidenav-logo">
      </div>
          <div class="menu-title" [class.condensed-title]="isSidenavCondensed">MENU</div>
          
          <!-- Top Divider Line -->
          <div class="nav-divider"></div>
          
      <mat-nav-list>
        <a mat-list-item routerLink="/profile" routerLinkActive="active" [attr.data-tooltip]="isSidenavCondensed ? 'Work Profile' : null">
          <div class="item-content">
            <mat-icon>account_circle</mat-icon>
                <span class="nav-label" [class.hidden]="isSidenavCondensed">Work Profile</span>
          </div>
        </a>
        <a mat-list-item routerLink="/bookings" routerLinkActive="active" [attr.data-tooltip]="isSidenavCondensed ? 'Bookings' : null">
          <div class="item-content">
            <mat-icon>book</mat-icon>
                <span class="nav-label" [class.hidden]="isSidenavCondensed">Bookings</span>
          </div>
        </a>
        <a mat-list-item routerLink="/user_request" routerLinkActive="active" [attr.data-tooltip]="isSidenavCondensed ? 'Requests' : null">
          <div class="item-content">
            <mat-icon>request_page</mat-icon>
                <span class="nav-label" [class.hidden]="isSidenavCondensed">Requests</span>
          </div>
        </a>
        <a mat-list-item routerLink="/worker-transaction" routerLinkActive="active" [attr.data-tooltip]="isSidenavCondensed ? 'Transaction' : null">
          <div class="item-content">
            <mat-icon>receipt</mat-icon>
                <span class="nav-label" [class.hidden]="isSidenavCondensed">Transaction</span>
          </div>
        </a>
        <a mat-list-item routerLink="/worker-messages" routerLinkActive="active" [attr.data-tooltip]="isSidenavCondensed ? 'Messages' : null">
          <div class="item-content">
            <mat-icon>chat</mat-icon>
                <span class="nav-label" [class.hidden]="isSidenavCondensed">Messages</span>
          </div>
        </a>
          </mat-nav-list>
          
          <!-- Bottom Divider Line -->
          <div class="nav-divider"></div>
        </div>
        <div class="sidenav-bottom">
          <a mat-list-item (click)="logout()" class="logout-button" [attr.data-tooltip]="isSidenavCondensed ? 'Logout' : null">
          <div class="item-content">
            <mat-icon>exit_to_app</mat-icon>
              <span class="nav-label" [class.hidden]="isSidenavCondensed">Logout</span>
          </div>
        </a>
        </div>
      </div>
    </mat-sidenav>

    <!-- Main Content -->
    <mat-sidenav-content>
      <mat-toolbar color="primary" class="responsive-toolbar">
        <div class="toolbar-left">
          <!-- Toggle collapse button -->
          <button mat-icon-button (click)="toggleSidenavMode()" *ngIf="!isMobileView && !isTopnavMode" title="Toggle condensed view">
            <mat-icon>{{ isSidenavCondensed ? 'menu_open' : 'menu' }}</mat-icon>
          </button>
          <!-- Toggle sidenav visibility -->
          <button mat-icon-button (click)="sidenav.toggle()" *ngIf="!isMobileView && !isTopnavMode" title="Toggle sidenav">
            <mat-icon>{{ isSidenavOpen ? 'chevron_left' : 'chevron_right' }}</mat-icon>
          </button>
          <!-- Toggle between sidenav and topnav -->
          <button mat-icon-button (click)="toggleNavigationMode()" *ngIf="!isMobileView" title="Toggle navigation mode">
            <mat-icon>{{ isTopnavMode ? 'view_sidebar' : 'view_agenda' }}</mat-icon>
        </button>
        </div>

        <span class="toolbar-title">BARANGAY MATAIN HANAP-SERBISYO</span>
        <span class="spacer"></span>

        <!-- Top Navigation for Default Users -->
        <div class="topnav-menu" *ngIf="isTopnavMode && showSidenav && !showSkilledWorkerSidenav">
          <a mat-button routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            <mat-icon>home</mat-icon>
            <span>Home</span>
          </a>
          <a mat-button routerLink="/favorites" routerLinkActive="active">
            <mat-icon>favorite</mat-icon>
            <span>Favorites</span>
          </a>
          <a mat-button routerLink="/transaction" routerLinkActive="active">
            <mat-icon>currency_exchange</mat-icon>
            <span>Transactions</span>
          </a>
          <a mat-button routerLink="/user-messages" routerLinkActive="active">
            <mat-icon>chat</mat-icon>
            <span>Messages</span>
          </a>
          <a mat-button routerLink="/user-profile" routerLinkActive="active">
            <mat-icon>person</mat-icon>
            <span>My Profile</span>
          </a>
          <a mat-button routerLink="/about_us" routerLinkActive="active">
            <mat-icon>info</mat-icon>
            <span>About Us</span>
          </a>
        </div>

        <!-- Top Navigation for Skilled Workers -->
        <div class="topnav-menu" *ngIf="isTopnavMode && showSkilledWorkerSidenav && !showSidenav">
          <a mat-button routerLink="/profile" routerLinkActive="active">
            <mat-icon>account_circle</mat-icon>
            <span>Work Profile</span>
          </a>
          <a mat-button routerLink="/bookings" routerLinkActive="active">
            <mat-icon>book</mat-icon>
            <span>Bookings</span>
          </a>
          <a mat-button routerLink="/user_request" routerLinkActive="active">
            <mat-icon>request_page</mat-icon>
            <span>Requests</span>
          </a>
          <a mat-button routerLink="/worker-transaction" routerLinkActive="active">
            <mat-icon>receipt</mat-icon>
            <span>Transaction</span>
          </a>
          <a mat-button routerLink="/worker-messages" routerLinkActive="active">
            <mat-icon>chat</mat-icon>
            <span>Messages</span>
          </a>
        </div>

        <!-- Show profile container only for regular users -->
        <div class="toolbar-profile-container" *ngIf="showSidenav && !showSkilledWorkerSidenav">
          <div class="profile-image-container" (click)="openEditProfileDialog()">
            <img src="assets/user-login.jpg" alt="Profile" class="profile-image">
            <div class="edit-overlay">
              <mat-icon>edit</mat-icon>
            </div>
          </div>
        </div>
      </mat-toolbar>

      <div class="content">
        <router-outlet></router-outlet>
      </div>

      <!-- Mobile Bottom Navigation for Default Users -->
      <nav class="mobile-nav" *ngIf="isMobileView && showSidenav && !showSkilledWorkerSidenav">
        <a routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
          <mat-icon>home</mat-icon>
          <span>Home</span>
        </a>
        <a routerLink="/user-profile" routerLinkActive="active">
          <mat-icon>person</mat-icon>
          <span>Profile</span>
        </a>
        <a routerLink="/favorites" routerLinkActive="active">
          <mat-icon>favorite</mat-icon>
          <span>Favorites</span>
        </a>
        <a routerLink="/transaction" routerLinkActive="active">
          <mat-icon>currency_exchange</mat-icon>
          <span>Transactions</span>
        </a>
        <a routerLink="/user-messages" routerLinkActive="active">
          <mat-icon>chat</mat-icon>
          <span>Messages</span>
        </a>
        <a (click)="openMobileMenu()">
          <mat-icon>more_horiz</mat-icon>
          <span>More</span>
        </a>
      </nav>

      <!-- Mobile Bottom Navigation for Skilled Workers -->
      <nav class="mobile-nav" *ngIf="isMobileView && showSkilledWorkerSidenav && !showSidenav">
        <a routerLink="/profile" routerLinkActive="active">
          <mat-icon>account_circle</mat-icon>
          <span>Profile</span>
        </a>
        <a routerLink="/bookings" routerLinkActive="active">
          <mat-icon>book</mat-icon>
          <span>Bookings</span>
        </a>
        <a routerLink="/user_request" routerLinkActive="active">
          <mat-icon>request_page</mat-icon>
          <span>Requests</span>
        </a>
        <a routerLink="/worker-messages" routerLinkActive="active">
          <mat-icon>chat</mat-icon>
          <span>Messages</span>
        </a>
        <a (click)="openMobileMenu()">
          <mat-icon>more_horiz</mat-icon>
          <span>More</span>
        </a>
      </nav>
    </mat-sidenav-content>
  </mat-sidenav-container>
</ng-container>

<!-- Fallback for Non-Sidenav Routes -->
<router-outlet *ngIf="!showSidenav && !showSkilledWorkerSidenav"></router-outlet>

<!-- Mobile Menu Dialog -->
<ng-template #mobileMenuDialog>
  <div class="mobile-menu-dialog">
    <h2>More Options</h2>
    <mat-nav-list>
      <ng-container *ngIf="showSidenav && !showSkilledWorkerSidenav">
        <a mat-list-item routerLink="/about_us">
          <mat-icon>info</mat-icon>
          <span>About Us</span>
        </a>
      </ng-container>
      <ng-container *ngIf="showSkilledWorkerSidenav && !showSidenav">
        <a mat-list-item routerLink="/worker-transaction">
          <mat-icon>receipt</mat-icon>
          <span>Transaction</span>
        </a>
      </ng-container>
      <a mat-list-item (click)="logout()">
        <mat-icon>exit_to_app</mat-icon>
        <span>Logout</span>
      </a>
    </mat-nav-list>
  </div>
</ng-template>