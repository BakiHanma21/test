<!-- Dashboard Container -->
<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header" [ngClass]="{'header-shifted': !sidebarOpen}">
    <div class="sidebar-toggle-container">
      <button class="sidebar-toggle-inside" (click)="toggleSidebar()">☰</button>
      <span class="welcome-message">Welcome Admin!</span>
    </div>
  </div>

  <!-- Sidebar Navigation -->
  <div class="sidebar" [class.open]="sidebarOpen">
    <div class="sidebar-header">
      <div class="logo">
        <img src="assets/matain-logo-copy.png" alt="Company Logo" />
        <p class="pol">User Management System</p>
      </div>
      <button class="close-sidebar" (click)="toggleSidebar()">×</button>
    </div>
    <hr class="logo-line" />
    
    <nav class="sidebar-nav">
      <h4 class="menu-title">Menu</h4>
      <ul class="nav-links">
        <li>
          <a routerLink="/dashboard-management" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
          </a>
        </li>
        <li>
          <a routerLink="/profile-management" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            <i class="fas fa-user"></i> <span>Profile</span>
          </a>
        </li>
        <li>
          <a routerLink="/role-based-access-control" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            <i class="fas fa-users-cog"></i> <span>Role-Based Access</span>
          </a>
        </li>
        <li>
          <a routerLink="/user-verification" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            <i class="fas fa-check-circle"></i> <span>Verifications</span>
          </a>
        </li>
        <li>
          <a routerLink="/admin-messages" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            <i class="fas fa-comment"></i> <span>Messages</span>
          </a>
        </li>
      </ul>
    </nav>
    
    <div class="logout">
      <a (click)="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-content" [ngStyle]="{ 'margin-left': sidebarOpen ? '250px' : '0' }">
    <!-- Header Section -->
    <div class="header-container">
      <div class="header-content">
        <h1>Verification Management<span class="material-icons">verified_user</span></h1>
        <div class="divider"></div>
        <div class="header-text">
          <p class="subtitle">Manage and verify user registrations</p>
        </div>
      </div>
      <div class="header-background">VERIFICATION</div>
    </div>

    <!-- Main Section -->
    <div class="section-container">
      <div class="section-header">
        <div class="header-left">
          <h2>Pending Verifications</h2>
          <div class="search-container">
            <input
              type="text"
              placeholder="Search by name..."
              [(ngModel)]="searchTerm"
              (input)="searchUser()"
              class="search-input"
            />
            <i class="fas fa-search search-icon"></i>
          </div>
        </div>
        <div class="header-right">
          <div class="filter-container">
            <select class="filter-select" [(ngModel)]="selectedFilter" (change)="filterUsers()" aria-label="Filter users by type">
              <option value="all">All Users</option>
              <option value="regular">Regular Users</option>
              <option value="skilled">Skilled Workers</option>
            </select>
          </div>
        </div>
      </div>

      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Location</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of filteredUsers">
              <td>
                <div class="user-info">
                  <img [src]="user.image || 'assets/default-avatar.png'" alt="User" class="user-avatar">
                  <span>{{ user.name }}</span>
                </div>
              </td>
              <td>{{ user.email }}</td>
              <td>
                <span class="role-badge" [ngClass]="user.role.toLowerCase()">{{ user.role }}</span>
              </td>
              <td>{{ user.purok ? user.purok + ', ' + user.street : user.location }}</td>
              <td>
                <span class="status-badge" [ngClass]="user.status.toLowerCase()">
                  {{ user.status }}
                </span>
              </td>
              <td>
                <div class="actions">
                  <button class="action-btn view" (click)="viewProfile(user)" title="View Profile">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="action-btn approve" (click)="openApproveForm(user)" title="Approve">
                    <i class="fas fa-check"></i>
                  </button>
                  <button class="action-btn deny" (click)="openDenyForm(user)" title="Deny">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- Backdrop/Overlay for Mobile -->
  <div class="sidebar-backdrop" *ngIf="sidebarOpen" (click)="toggleSidebar()"></div>
</div>

<!-- Modals -->
<!-- Profile Modal -->
<div class="modal-overlay" *ngIf="isProfileModalVisible">
  <div class="modal-content">
    <div class="modal-header">
      <h3>User Profile</h3>
      <button class="close-modal" (click)="closeProfileModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="profile-image">
        <img [src]="currentUser.image || 'assets/default-avatar.png'" alt="Profile Image" class="profile-img">
      </div>
      <div class="profile-details">
        <div class="info-group">
          <label>Name:</label>
          <p>{{ currentUser.name }}</p>
        </div>
        <div class="info-group">
          <label>Email:</label>
          <p>{{ currentUser.email }}</p>
        </div>
        <div class="info-group">
          <label>Role:</label>
          <p>{{ currentUser.role }}</p>
        </div>
        <div class="info-group">
          <label>Location:</label>
          <p>{{ currentUser.purok ? currentUser.purok + ', ' + currentUser.street : currentUser.location }}</p>
        </div>
        <div class="info-group" *ngIf="currentUser.contactNumber">
          <label>Contact Number:</label>
          <p>{{ currentUser.contactNumber }}</p>
        </div>
        <div class="info-group" *ngIf="currentUser.skills">
          <label>Skills:</label>
          <p>{{ currentUser.skills }}</p>
        </div>
        <div class="info-group" *ngIf="currentUser.experience">
          <label>Experience:</label>
          <p>{{ currentUser.experience }} years</p>
        </div>
      </div>
      <div class="valid-id-section" *ngIf="currentUser.valid_id">
        <h4>Valid ID</h4>
        <img [src]="currentUser.valid_id" alt="Valid ID" class="valid-id-img">
      </div>
    </div>
    <div class="modal-footer">
      <button class="cancel-btn" (click)="closeProfileModal()">Close</button>
    </div>
  </div>
</div>

<!-- Approve Modal -->
<div class="modal-overlay" *ngIf="isApproveFormVisible">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Confirm Approval</h3>
      <button class="close-modal" (click)="closeForms()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="confirmation-content">
        <i class="fas fa-check-circle success-icon"></i>
        <p>Are you sure you want to approve <strong>{{ currentUser.name }}</strong>?</p>
        <p class="sub-text">This action will grant the user access to the system.</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="save-btn" (click)="approveUser(currentUser)">
        <i class="fas fa-check"></i> Confirm Approval
      </button>
      <button class="cancel-btn" (click)="closeForms()">Cancel</button>
    </div>
  </div>
</div>

<!-- Deny Modal -->
<div class="modal-overlay" *ngIf="isDenyFormVisible">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Confirm Denial</h3>
      <button class="close-modal" (click)="closeForms()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="confirmation-content">
        <i class="fas fa-times-circle danger-icon"></i>
        <p>Are you sure you want to deny <strong>{{ currentUser.name }}</strong>?</p>
        <p class="sub-text">This action cannot be undone.</p>
      </div>
      <div class="form-group">
        <label>Reason for Denial:</label>
        <textarea class="form-control" [(ngModel)]="commentText" placeholder="Please provide a reason..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="delete-btn" (click)="denyUser(currentUser)">
        <i class="fas fa-times"></i> Confirm Denial
      </button>
      <button class="cancel-btn" (click)="closeForms()">Cancel</button>
    </div>
  </div>
</div>

<!-- Comment Modal -->
<div class="modal-overlay" *ngIf="isCommentFormVisible">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add Comment</h3>
      <button class="close-modal" (click)="closeForms()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="info-message">
        <i class="fas fa-info-circle"></i>
        <p>Your comment will be sent to their email account</p>
      </div>
      <div class="form-group">
        <textarea class="form-control" [(ngModel)]="commentText" placeholder="Enter your comment..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="save-btn" (click)="submitComment(currentUser)">
        <i class="fas fa-paper-plane"></i> Submit Comment
      </button>
      <button class="cancel-btn" (click)="closeForms()">Cancel</button>
    </div>
  </div>
</div>